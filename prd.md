# **Product Requirements Document (PRD)**

---

## **Project Overview**
The project aims to create a real-time collaborative platform where:
1. **Admins** can create live parties.
2. **Volunteers** can join live parties using a unique code generated by the admin.
3. Each party is associated with a shared dataset that volunteers can view and update in real-time.
4. The system ensures no duplicate entries are allowed, and each entry has specific attributes (`name`, `id`, `entryTime`, `exitTime`).

The platform will be built using **Flutter** for the frontend and **Firebase** for backend services (Firestore for real-time database, Firebase Authentication for user roles, etc.). The app will support both mobile and web platforms.

---

## **Key Features**

### **1. Admin Functionality**
- **Create a Live Party**:
  - Admins can create a new live party.
  - Upon creation, a unique alphanumeric code (e.g., `ABC123`) is generated for the party.
  - The party is stored in Firestore with the following attributes:
    - `partyCode`: Unique identifier for the party.
    - `adminId`: ID of the admin who created the party.
    - `createdAt`: Timestamp of when the party was created.
    - `volunteers`: Array of volunteer UIDs who have joined the party.
    - `entries`: Subcollection of entries added by volunteers.
  - Admins can view a list of all parties they have created, along with details such as:
    - Number of volunteers.
    - Number of entries.
    - Active status (whether the party is still open for joining).

- **Manage Parties**:
  - Admins can view, edit, or delete parties they have created.
  - Admins can close a party, preventing further volunteer joins.

### **2. Volunteer Functionality**
- **Join a Live Party**:
  - Volunteers can join a live party by entering the unique party code.
  - Validation ensures the party code exists and is active.
  - Once joined, the volunteer is added to the `volunteers` array in Firestore.
  - Volunteers can view and interact with the shared dataset in real-time.

- **Add Entries**:
  - Volunteers can add new entries to the dataset.
  - Each entry must include:
    - `name`: A non-null string.
    - `id`: A non-null string (unique within the party).
    - `entryTime`: Automatically set to the current timestamp when the entry is added.
    - `exitTime`: Initially null; can be updated later via a button in the UI.
  - Duplicate entries (based on `id`) are not allowed. If a duplicate `id` is detected, an error message is displayed.

- **Mark Exit Time**:
  - Each entry in the UI has a button labeled "Mark Exit".
  - Clicking the button updates the `exitTime` field with the current timestamp.
  - Volunteers can only mark exit time for entries they have added.

### **3. Real-Time Collaboration**
- The dataset is shared in real-time among all volunteers in the same party.
- Any changes made by one volunteer (e.g., adding an entry or marking exit time) are immediately reflected for all other volunteers.
- Real-time updates are achieved using Firestore's `snapshots()` method.

### **4. Security and Validation**
- **Authentication**:
  - Admins and volunteers must log in using Firebase Authentication.
  - Roles (admin/volunteer) are managed via custom claims or Firestore rules.
  - Admins have elevated permissions to create and manage parties, while volunteers have limited access to join and contribute to parties.

- **Data Validation**:
  - Ensure `name` and `id` are non-null when adding an entry.
  - Prevent duplicate entries based on `id`.
  - Validate party codes during the join process to ensure they exist and are active.

- **Access Control**:
  - Only admins can create parties.
  - Only volunteers who have joined a party can view and modify its dataset.
  - Closed parties cannot be joined by new volunteers.

---

## **User Stories**

### **Admin User Stories**
1. As an admin, I want to create a live party so that volunteers can join and collaborate.
2. As an admin, I want to generate a unique code for each party so that volunteers can use it to join.
3. As an admin, I want to view the list of parties I have created along with their details (e.g., number of volunteers, entries).
4. As an admin, I want to close a party so that no new volunteers can join.
5. As an admin, I want to delete a party if it is no longer needed.

### **Volunteer User Stories**
1. As a volunteer, I want to join a live party using a unique code so that I can collaborate with others.
2. As a volunteer, I want to view the shared dataset in real-time so that I can stay updated with the latest entries.
3. As a volunteer, I want to add new entries to the dataset so that I can contribute to the collaboration.
4. As a volunteer, I want to mark the exit time of an entry so that the dataset reflects accurate timestamps.
5. As a volunteer, I want to see an error message if I try to add a duplicate entry.

---

## **Technical Design**

### **1. Firebase Structure**
#### **Firestore Collections**
- **Parties**:
  - `partyCode`: String (unique identifier for the party).
  - `adminId`: String (ID of the admin who created the party).
  - `createdAt`: Timestamp (when the party was created).
  - `volunteers`: Array of volunteer UIDs who have joined the party.
  - `isActive`: Boolean (indicates whether the party is open for joining).
  - `entries`: Subcollection of entries added by volunteers.

- **Entries** (Subcollection under each party):
  - `name`: String (non-null).
  - `id`: String (non-null, unique within the party).
  - `entryTime`: Timestamp (automatically set when the entry is added).
  - `exitTime`: Timestamp (initially null, updated when "Mark Exit" is clicked).
  - `addedBy`: String (UID of the volunteer who added the entry).

#### **Firebase Authentication**
- Users are authenticated using Firebase Authentication.
- Admins and volunteers are differentiated using custom claims or Firestore rules.

### **2. Flutter Architecture**
#### **State Management**
- Use a state management solution like **Provider** or **Riverpod** to manage app state (e.g., party data, user authentication).
- For real-time updates, use Firestore's `snapshots()` method to listen for changes in the dataset.

#### **UI Components**
- **Admin Dashboard**:
  - Button to create a new party.
  - List of created parties with details (e.g., number of volunteers, entries, active status).
  - Option to close or delete a party.

- **Volunteer Dashboard**:
  - Input field to enter the party code and join a party.
  - Display of the shared dataset with real-time updates.
  - Form to add new entries with validation for `name` and `id`.
  - Button on each entry to mark exit time.

#### **Validation**
- Validate `name` and `id` fields before adding an entry.
- Check for duplicate `id` values in the Firestore subcollection before allowing a new entry.
- Validate party codes during the join process to ensure they exist and are active.

---

## **Implementation Plan**

### **Phase 1: Setup**
1. Set up Firebase project and configure Firestore, Authentication, and Security Rules.
2. Initialize Flutter project and integrate Firebase dependencies (`firebase_core`, `cloud_firestore`, `firebase_auth`).
3. Implement user authentication and role assignment (admin/volunteer).

### **Phase 2: Admin Functionality**
1. Build the "Create Party" feature, including generating a unique party code and storing it in Firestore.
2. Implement the ability for admins to view, close, and delete parties.
3. Add real-time updates for the list of parties.

### **Phase 3: Volunteer Functionality**
1. Implement volunteer login and role assignment.
2. Build the "Join Party" feature, including validation of the party code.
3. Implement real-time updates for the shared dataset.

### **Phase 4: Entry Management**
1. Build the form to add new entries with validation for `name` and `id`.
2. Add a button to mark exit time for each entry.
3. Implement error handling for duplicate entries and invalid inputs.

### **Phase 5: Testing and Deployment**
1. Test the app thoroughly for edge cases (e.g., duplicate entries, invalid party codes, closed parties).
2. Deploy the app to Firebase Hosting (for web) or publish it to app stores (for mobile).

---

## **Security Rules**

### **Firestore Rules**
```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Parties collection
    match /parties/{partyId} {
      allow read, write: if request.auth != null && request.auth.token.admin == true;

      // Entries subcollection
      match /entries/{entryId} {
        allow read: if request.auth != null;
        allow create: if request.auth != null && request.resource.data.name != null && request.resource.data.id != null;
        allow update: if request.auth != null && request.resource.data.exitTime != null;
      }
    }
  }
}
```

---

## **Future Enhancements**
1. Add analytics to track party activity (e.g., number of entries, average time spent).
2. Enable notifications for volunteers when a new entry is added.
3. Allow admins to edit or delete parties.
4. Export party data as a CSV file.
5. Implement a search/filter feature for entries in the dataset.
6. Add a dashboard for admins to view aggregated statistics about all parties.

---
